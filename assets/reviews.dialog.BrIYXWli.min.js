function __vite__mapDeps(indexes) {
    if (!__vite__mapDeps.viteFileDeps) {
        __vite__mapDeps.viteFileDeps = ["assets/review.submit.form.DEbzpy2I.min.js", "assets/app.BSN4W8HM.min.js", "assets/app-Dwqn0-uG.css", "assets/error.api.BP9hZPsV.min.js", "assets/AlertTitle.BwQ6E1s4.min.js", "assets/TruncateShowOrHide.es3nm7ZL.min.js", "assets/styles.-VfZxx2n.min.js", "assets/Collapse.qrkGNfOW.min.js", "assets/component.D953kRkM.min.js", "assets/lazy-avatar.C01FGxiO.min.js", "assets/Divider.s2eBBWcw.min.js", "assets/ActivateButton.CUtwAnvT.min.js", "assets/_baseForOwn.CkzZgw4H.min.js", "assets/_baseIteratee.BeczBJkZ.min.js", "assets/_cacheHas.3dpnCmml.min.js", "assets/_baseProperty.q3tcxGBl.min.js", "assets/reply.6u_hcxNG.min.js", "assets/query.progress.Du4NbiWx.min.js", "assets/pin.CgX2BX4o.min.js", "assets/TruncateDisclosure.EJsU_sLh.min.js", "assets/UserFlairBadge.D4YxxncA.min.js", "assets/html.CLZ4OSMb.min.js", "assets/index.DVPf4jiX.min.js", "assets/_arrayIncludesWith.BskCksw4.min.js", "assets/index.DXPNvZkV.min.js", "assets/use-immer.module.cCdRkcOp.min.js", "assets/util.CeAI_f06.min.js", "assets/NovelReviewScore.BA_adrvz.min.js"]
    }
    return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
import {
    aY as fs,
    a$ as gs,
    aZ as xs,
    aM as oe,
    r as i,
    a_ as bs,
    aT as Rs,
    aU as Ns,
    b4 as Cs,
    aX as Ts,
    u as Oe,
    M as g,
    a3 as Le,
    ah as $e,
    v as qe,
    ag as z,
    ay as Ge,
    w as L,
    U as Ve,
    R as De,
    j as s,
    h as A,
    f as d,
    g as q,
    t as F,
    a8 as B,
    dv as ks,
    a6 as re,
    k as Ye,
    a7 as H,
    ch as We,
    an as $,
    aH as je,
    e as ue,
    x as pe,
    y as ve,
    dw as ee,
    dx as ys,
    aE as Fe,
    cL as Be,
    cM as He,
    cv as Is,
    bk as Qe,
    al as As,
    am as Ss,
    N as W,
    dq as he,
    bX as ie,
    bW as le,
    at as Ms,
    aG as Us,
    b_ as _e,
    cl as Te,
    S as Ps,
    aC as Es,
    ao as Os,
    dy as Ls,
    aJ as $s
} from "./app.BSN4W8HM.min.js";
import {
    U as we,
    T as Z,
    C as ze,
    S as Ze
} from "./TruncateShowOrHide.es3nm7ZL.min.js";
import {
    L as K,
    S as ke
} from "./lazy-avatar.C01FGxiO.min.js";
import {
    S as qs
} from "./reply.6u_hcxNG.min.js";
import {
    Q as Gs
} from "./query.progress.Du4NbiWx.min.js";
import {
    S as Vs
} from "./pin.CgX2BX4o.min.js";
import {
    T as Y
} from "./TruncateDisclosure.EJsU_sLh.min.js";
import {
    A as Ke
} from "./styles.-VfZxx2n.min.js";
import {
    U as Xe
} from "./UserFlairBadge.D4YxxncA.min.js";
import {
    u as Je,
    p as Ds,
    P as Ys
} from "./html.CLZ4OSMb.min.js";
import {
    D as Ws
} from "./Divider.s2eBBWcw.min.js";
import {
    A as js
} from "./error.api.BP9hZPsV.min.js";
import {
    A as Fs
} from "./ActivateButton.CUtwAnvT.min.js";
import {
    s as es,
    b as Bs
} from "./_baseIteratee.BeczBJkZ.min.js";
import {
    S as Hs,
    c as Qs
} from "./_cacheHas.3dpnCmml.min.js";
import {
    a as _s,
    b as zs
} from "./_arrayIncludesWith.BskCksw4.min.js";
import {
    r as Zs
} from "./index.DXPNvZkV.min.js";
import {
    i as Ks
} from "./use-immer.module.cCdRkcOp.min.js";
import {
    E as Xs,
    T as Js
} from "./index.DVPf4jiX.min.js";
import {
    o as en,
    a as sn
} from "./util.CeAI_f06.min.js";
import {
    N as se
} from "./NovelReviewScore.BA_adrvz.min.js";

function nn(e) {
    return fs("MuiCardActions", e)
}
gs("MuiCardActions", ["root", "spacing"]);
const tn = ["disableSpacing", "className"],
    an = e => {
        const {
            classes: n,
            disableSpacing: t
        } = e;
        return Ts({
            root: ["root", !t && "spacing"]
        }, nn, n)
    },
    on = xs("div", {
        name: "MuiCardActions",
        slot: "Root",
        overridesResolver: (e, n) => {
            const {
                ownerState: t
            } = e;
            return [n.root, !t.disableSpacing && n.spacing]
        }
    })(({
        ownerState: e
    }) => oe({
        display: "flex",
        alignItems: "center",
        padding: 8
    }, !e.disableSpacing && {
        "& > :not(style) ~ :not(style)": {
            marginLeft: 8
        }
    })),
    rn = i.forwardRef(function(n, t) {
        const a = bs({
                props: n,
                name: "MuiCardActions"
            }),
            {
                disableSpacing: o = !1,
                className: r
            } = a,
            c = Rs(a, tn),
            m = oe({}, a, {
                disableSpacing: o
            }),
            u = an(m);
        return Ns.jsx(on, oe({
            className: Cs(u.root, r),
            ownerState: m,
            ref: t
        }, c))
    }),
    ln = rn;
var cn = ["mousedown", "touchstart"],
    dn = function(e, n, t) {
        t === void 0 && (t = cn);
        var a = i.useRef(n);
        i.useEffect(function() {
            a.current = n
        }, [n]), i.useEffect(function() {
            for (var o = function(u) {
                    var l = e.current;
                    l && !l.contains(u.target) && a.current(u)
                }, r = 0, c = t; r < c.length; r++) {
                var m = c[r];
                en(document, m, o)
            }
            return function() {
                for (var u = 0, l = t; u < l.length; u++) {
                    var p = l[u];
                    sn(document, p, o)
                }
            }
        }, [t, e])
    },
    ss = (e => (e[e.All = 0] = "All", e[e.Novels = 1] = "Novels", e[e.Products = 2] = "Products", e))(ss || {}),
    X = (e => (e[e.Default = 0] = "Default", e[e.Relevance = 1] = "Relevance", e[e.Newest = 2] = "Newest", e[e.Oldest = 3] = "Oldest", e[e.Best = 4] = "Best", e[e.Worst = 5] = "Worst", e))(X || {}),
    ns = (e => (e[e.Default = 0] = "Default", e[e.Rejected = 1] = "Rejected", e[e.ReApproval = 2] = "ReApproval", e[e.Approved = 3] = "Approved", e))(ns || {}),
    U = (e => (e[e.None = 0] = "None", e[e.ThumbsDown = -1] = "ThumbsDown", e[e.ThumbsUp = 1] = "ThumbsUp", e))(U || {}),
    j = (e => (e[e.NoneReviewType = 0] = "NoneReviewType", e[e.NovelReviewType = 1] = "NovelReviewType", e[e.ProductReviewType = 2] = "ProductReviewType", e))(j || {});
class mn extends g {
    constructor() {
        super("wuxiaworld.api.v2.CreateReviewRequest", [{
            no: 1,
            name: "voteType",
            kind: "enum",
            T: () => ["wuxiaworld.api.v2.ReviewItem.VoteType", U],
            options: {
                "wuxiaworld.api.v2.required": {
                    value: !0
                },
                "wuxiaworld.api.v2.display": {
                    name: "Vote Type"
                }
            }
        }, {
            no: 2,
            name: "content",
            kind: "scalar",
            T: 9,
            options: {
                "wuxiaworld.api.v2.stringLength": {
                    maxLength: {
                        value: 8192
                    }
                },
                "wuxiaworld.api.v2.display": {
                    name: "Content"
                },
                "wuxiaworld.api.v2.wordLength": {
                    minWords: {
                        value: 100
                    }
                }
            }
        }, {
            no: 3,
            name: "novelId",
            kind: "scalar",
            oneof: "type",
            T: 5
        }, {
            no: 4,
            name: "productId",
            kind: "scalar",
            oneof: "type",
            T: 5
        }])
    }
}
const un = new mn;
class pn extends g {
    constructor() {
        super("wuxiaworld.api.v2.CreateReviewResponse", [{
            no: 1,
            name: "item",
            kind: "message",
            T: () => Q
        }])
    }
}
const vn = new pn;
class hn extends g {
    constructor() {
        super("wuxiaworld.api.v2.UpdateReviewRequest", [{
            no: 1,
            name: "id",
            kind: "scalar",
            T: 5
        }, {
            no: 2,
            name: "voteType",
            kind: "enum",
            T: () => ["wuxiaworld.api.v2.ReviewItem.VoteType", U],
            options: {
                "wuxiaworld.api.v2.required": {
                    value: !0
                },
                "wuxiaworld.api.v2.display": {
                    name: "Vote Type"
                }
            }
        }, {
            no: 3,
            name: "content",
            kind: "scalar",
            T: 9,
            options: {
                "wuxiaworld.api.v2.stringLength": {
                    maxLength: {
                        value: 8192
                    }
                },
                "wuxiaworld.api.v2.display": {
                    name: "Content"
                },
                "wuxiaworld.api.v2.wordLength": {
                    minWords: {
                        value: 100
                    }
                }
            }
        }, {
            no: 4,
            name: "novelId",
            kind: "scalar",
            oneof: "type",
            T: 5
        }, {
            no: 5,
            name: "productId",
            kind: "scalar",
            oneof: "type",
            T: 5
        }])
    }
}
const wn = new hn;
class fn extends g {
    constructor() {
        super("wuxiaworld.api.v2.UpdateReviewResponse", [{
            no: 1,
            name: "item",
            kind: "message",
            T: () => Q
        }])
    }
}
const gn = new fn;
class xn extends g {
    constructor() {
        super("wuxiaworld.api.v2.SubmitReviewVoteRequest", [{
            no: 1,
            name: "id",
            kind: "scalar",
            T: 5
        }, {
            no: 2,
            name: "type",
            kind: "enum",
            T: () => ["wuxiaworld.api.v2.ReviewType", j]
        }, {
            no: 3,
            name: "voteType",
            kind: "enum",
            T: () => ["wuxiaworld.api.v2.ReviewItem.VoteType", U],
            options: {
                "wuxiaworld.api.v2.required": {
                    value: !0
                },
                "wuxiaworld.api.v2.display": {
                    name: "Vote Type"
                }
            }
        }])
    }
}
const ts = new xn;
class bn extends g {
    constructor() {
        super("wuxiaworld.api.v2.SubmitReviewVoteResponse", [{
            no: 1,
            name: "result",
            kind: "scalar",
            T: 8
        }, {
            no: 2,
            name: "upVotes",
            kind: "scalar",
            T: 5
        }, {
            no: 3,
            name: "downVotes",
            kind: "scalar",
            T: 5
        }])
    }
}
const Rn = new bn;
class Nn extends g {
    constructor() {
        super("wuxiaworld.api.v2.GetUserReviewRequest", [{
            no: 1,
            name: "userId",
            kind: "scalar",
            T: 9,
            options: {
                "wuxiaworld.api.v2.required": {
                    value: !0
                }
            }
        }, {
            no: 2,
            name: "novelId",
            kind: "scalar",
            oneof: "type",
            T: 5
        }, {
            no: 3,
            name: "productId",
            kind: "scalar",
            oneof: "type",
            T: 5
        }])
    }
}
const as = new Nn;
class Cn extends g {
    constructor() {
        super("wuxiaworld.api.v2.GetUserReviewResponse", [{
            no: 1,
            name: "item",
            kind: "message",
            T: () => Q
        }])
    }
}
const os = new Cn;
class Tn extends g {
    constructor() {
        super("wuxiaworld.api.v2.GetUserReviewsRequest", [{
            no: 1,
            name: "userId",
            kind: "scalar",
            T: 9
        }, {
            no: 2,
            name: "type",
            kind: "enum",
            T: () => ["wuxiaworld.api.v2.GetUserReviewsRequest.Type", ss]
        }])
    }
}
const kn = new Tn;
class yn extends g {
    constructor() {
        super("wuxiaworld.api.v2.GetUserReviewsResponse", [{
            no: 1,
            name: "items",
            kind: "message",
            repeat: 1,
            T: () => Q
        }])
    }
}
const In = new yn;
class An extends g {
    constructor() {
        super("wuxiaworld.api.v2.SearchReviewsRequest", [{
            no: 1,
            name: "novelId",
            kind: "scalar",
            oneof: "type",
            T: 5
        }, {
            no: 2,
            name: "productId",
            kind: "scalar",
            oneof: "type",
            T: 5
        }, {
            no: 3,
            name: "sortType",
            kind: "enum",
            T: () => ["wuxiaworld.api.v2.SearchReviewsRequest.SortType", X]
        }, {
            no: 5,
            name: "voteType",
            kind: "enum",
            T: () => ["wuxiaworld.api.v2.ReviewItem.VoteType", U]
        }, {
            no: 4,
            name: "pageInfo",
            kind: "message",
            T: () => Le,
            options: {
                "wuxiaworld.api.v2.required": {
                    value: !0
                }
            }
        }])
    }
}
const rs = new An;
class Sn extends g {
    constructor() {
        super("wuxiaworld.api.v2.SearchReviewsResponse", [{
            no: 1,
            name: "items",
            kind: "message",
            repeat: 1,
            T: () => Q
        }, {
            no: 2,
            name: "pageInfo",
            kind: "message",
            T: () => $e
        }])
    }
}
const Mn = new Sn;
class Un extends g {
    constructor() {
        super("wuxiaworld.api.v2.ReviewerSeriesInfo", [{
            no: 1,
            name: "isChampion",
            kind: "scalar",
            T: 8
        }])
    }
}
const Pn = new Un;
class En extends g {
    constructor() {
        super("wuxiaworld.api.v2.ReviewerEntityInfo", [{
            no: 1,
            name: "seriesInfo",
            kind: "message",
            oneof: "entityInfo",
            T: () => Pn
        }])
    }
}
const On = new En;
class Ln extends g {
    constructor() {
        super("wuxiaworld.api.v2.ReviewItem", [{
            no: 1,
            name: "id",
            kind: "scalar",
            T: 5
        }, {
            no: 2,
            name: "content",
            kind: "message",
            T: () => qe
        }, {
            no: 3,
            name: "reviewedAt",
            kind: "message",
            T: () => z
        }, {
            no: 4,
            name: "editedAt",
            kind: "message",
            T: () => z
        }, {
            no: 5,
            name: "reviewUser",
            kind: "message",
            T: () => Ge
        }, {
            no: 6,
            name: "reviewUserPast",
            kind: "message",
            T: () => Yn
        }, {
            no: 7,
            name: "votes",
            kind: "message",
            T: () => qn
        }, {
            no: 8,
            name: "totalComments",
            kind: "scalar",
            T: 5
        }, {
            no: 9,
            name: "novelId",
            kind: "scalar",
            oneof: "type",
            T: 5
        }, {
            no: 10,
            name: "productId",
            kind: "scalar",
            oneof: "type",
            T: 5
        }, {
            no: 11,
            name: "voteType",
            kind: "enum",
            T: () => ["wuxiaworld.api.v2.ReviewItem.VoteType", U]
        }, {
            no: 12,
            name: "hasPurchased",
            kind: "scalar",
            T: 8
        }, {
            no: 13,
            name: "rejectionInfo",
            kind: "message",
            T: () => Vn
        }, {
            no: 14,
            name: "reviewerEntityInfo",
            kind: "message",
            T: () => On
        }])
    }
}
const Q = new Ln;
class $n extends g {
    constructor() {
        super("wuxiaworld.api.v2.ReviewItem.Votes", [{
            no: 1,
            name: "upVotes",
            kind: "scalar",
            T: 5
        }, {
            no: 2,
            name: "downVotes",
            kind: "scalar",
            T: 5
        }])
    }
}
const qn = new $n;
class Gn extends g {
    constructor() {
        super("wuxiaworld.api.v2.ReviewItem.RejectionInfo", [{
            no: 1,
            name: "state",
            kind: "enum",
            T: () => ["wuxiaworld.api.v2.ReviewItem.RejectionInfo.State", ns]
        }, {
            no: 2,
            name: "reason",
            kind: "message",
            T: () => qe
        }, {
            no: 3,
            name: "rejectedAt",
            kind: "message",
            T: () => z
        }])
    }
}
const Vn = new Gn;
class Dn extends g {
    constructor() {
        super("wuxiaworld.api.v2.ReviewItem.PastUser", [{
            no: 1,
            name: "isVip",
            kind: "scalar",
            T: 8
        }])
    }
}
const Yn = new Dn,
    ne = new Oe("wuxiaworld.api.v2.Reviews", [{
        name: "CreateReview",
        options: {},
        I: un,
        O: vn
    }, {
        name: "UpdateReview",
        options: {},
        I: wn,
        O: gn
    }, {
        name: "SubmitReviewVote",
        options: {},
        I: ts,
        O: Rn
    }, {
        name: "GetUserReview",
        options: {},
        I: as,
        O: os
    }, {
        name: "GetUserReviews",
        options: {},
        I: kn,
        O: In
    }, {
        name: "SearchReviews",
        options: {},
        I: rs,
        O: Mn
    }]);
class fe {
    constructor(n) {
        this._transport = n, this.typeName = ne.typeName, this.methods = ne.methods, this.options = ne.options
    }
    createReview(n, t) {
        const a = this.methods[0],
            o = this._transport.mergeOptions(t);
        return L("unary", this._transport, a, o, n)
    }
    updateReview(n, t) {
        const a = this.methods[1],
            o = this._transport.mergeOptions(t);
        return L("unary", this._transport, a, o, n)
    }
    submitReviewVote(n, t) {
        const a = this.methods[2],
            o = this._transport.mergeOptions(t);
        return L("unary", this._transport, a, o, n)
    }
    getUserReview(n, t) {
        const a = this.methods[3],
            o = this._transport.mergeOptions(t);
        return L("unary", this._transport, a, o, n)
    }
    getUserReviews(n, t) {
        const a = this.methods[4],
            o = this._transport.mergeOptions(t);
        return L("unary", this._transport, a, o, n)
    }
    searchReviews(n, t) {
        const a = this.methods[5],
            o = this._transport.mergeOptions(t);
        return L("unary", this._transport, a, o, n)
    }
}
var ye;

function ce() {
    return ce = Object.assign ? Object.assign.bind() : function(e) {
        for (var n = 1; n < arguments.length; n++) {
            var t = arguments[n];
            for (var a in t) Object.prototype.hasOwnProperty.call(t, a) && (e[a] = t[a])
        }
        return e
    }, ce.apply(this, arguments)
}
var Wn = function(n) {
    return i.createElement("svg", ce({
        width: 20,
        height: 20,
        viewBox: "0 0 20 20",
        fill: "none",
        xmlns: "http://www.w3.org/2000/svg"
    }, n), ye || (ye = i.createElement("path", {
        fillRule: "evenodd",
        clipRule: "evenodd",
        d: "M0 16.049V7.384c0-.567.441-1.037 1.008-1.072L4.3 6.106v11.018H1.075A1.075 1.075 0 0 1 0 16.049Zm5.913 1.075h8.412c1.39 0 2.618-.903 3.033-2.23l1.478-4.732a3.593 3.593 0 0 0-3.787-4.647l-3.225.322 1.478-3.326A1.075 1.075 0 0 0 12.32 1h-.659a2.15 2.15 0 0 0-1.546.656L5.913 6.004v11.12Z",
        fill: "currentColor"
    })))
};

function jn({
    isChampionCommenter: e,
    comment: n,
    commentDateFromNow: t,
    commentHtmlContent: a,
    withBox: o = !0
}) {
    const r = Ve(De.downSm2, {
        noSsr: !0
    });
    return s("article", {
        className: A(o && "rounded-12 shadow-ww-text-container dark:bg-gray-950"),
        children: s("div", {
            className: "py-8",
            children: r ? d(q, {
                children: [d("div", {
                    className: "flex pb-10",
                    children: [s(Ie, {
                        isChampionCommenter: e,
                        comment: n,
                        isMobile: r
                    }), s("div", {
                        className: "ml-8 min-w-0 sm2:ml-0",
                        children: s(Ae, {
                            comment: n,
                            commentDateFromNow: t
                        })
                    })]
                }), s(Se, {
                    commentHtmlContent: a
                })]
            }) : d("div", {
                className: "flex",
                children: [s(Ie, {
                    isChampionCommenter: e,
                    comment: n,
                    isMobile: r
                }), d("div", {
                    className: "w-full min-w-0 sm2:ml-12",
                    children: [s("div", {
                        className: "ml-8 sm2:ml-0",
                        children: s(Ae, {
                            comment: n,
                            commentDateFromNow: t
                        })
                    }), s(Se, {
                        commentHtmlContent: a
                    })]
                })]
            })
        })
    })
}
const Ie = ({
        isChampionCommenter: e,
        comment: n,
        isMobile: t
    }) => {
        var a, o;
        return s(Fn, {
            isChampion: e,
            frameWidth: t ? 2 : 3,
            src: (o = (a = n.commenter) == null ? void 0 : a.avatarUrl) == null ? void 0 : o.value,
            className: "h-40 w-40 sm2:h-60 sm2:w-60",
            variant: "rounded",
            frameClasses: {
                badge: "w-30 h-14 sm2:w-34 sm2:h-16"
            },
            imageRenderSize: e ? 54 : 60
        })
    },
    Ae = ({
        comment: e,
        commentDateFromNow: n
    }) => {
        var t, a, o, r, c;
        return d(q, {
            children: [d("div", {
                className: "flex items-center pt-2",
                children: [s("div", {
                    className: "font-set-b14 truncate text-gray-t1 sm2:font-set-b16",
                    children: ((t = e.commenter) == null ? void 0 : t.userName) || "[Unknown Account]"
                }), ((o = (a = e.commenter) == null ? void 0 : a.flair) == null ? void 0 : o.value) && s(Xe, {
                    flair: e.commenter.flair.value
                }), ((r = e.commenter) == null ? void 0 : r.isVipActive) && s("div", {
                    className: "ml-2 sm2:ml-4",
                    children: s(we, {
                        badgeType: "vip",
                        vipType: (c = e.commenter.vip) == null ? void 0 : c.type
                    })
                })]
            }), d("div", {
                className: "font-set-r12 flex pt-2 text-gray-desc sm2:font-set-r13",
                children: [s("span", {
                    children: n
                }), e.isSticky && d(q, {
                    children: [s(Bn, {}), d("div", {
                        className: "flex items-center text-blue-600",
                        children: [s(Vs, {
                            className: "h-12 w-12"
                        }), s("span", {
                            children: "Pinned"
                        })]
                    })]
                })]
            })]
        })
    },
    Se = ({
        commentHtmlContent: e
    }) => {
        const n = Je(e || "", {
            transform: {
                p: Ds
            }
        });
        return s("div", {
            className: "rounded-12 bg-gray-container-base px-12 py-8 sm2:mt-8",
            children: d(Y, {
                children: [s(Y.Content, {
                    lines: 6,
                    children: n
                }), s(Y.Toggle, {
                    className: "font-set-m12 mt-6 mb-2",
                    showingComponent: s(Z, {
                        showing: !0
                    }),
                    hidingComponent: s(Z, {
                        showing: !1
                    })
                })]
            })
        })
    },
    Fn = ({
        isChampion: e,
        frameWidth: n,
        frameClasses: t,
        className: a,
        ...o
    }) => e ? s(ze, {
        frameWidth: n,
        classes: t,
        children: s(K, { ...o,
            className: "h-36 w-36 border-none sm2:h-54 sm2:w-54"
        })
    }) : d("div", {
        className: "relative",
        children: [s(K, { ...o,
            className: F(a, "rounded-6 border-none sm2:rounded-8")
        }), s("div", {
            className: F(Ke, a, "rounded-6 ring-[0.5px] ring-inset ring-black/10 sm2:rounded-8")
        })]
    }),
    Bn = () => s("div", {
        className: "w-10 text-center",
        children: "·"
    });
B.extend(ks);

function Hn({
    comment: e
}) {
    var o, r;
    const n = i.useMemo(() => B.unix(re(e.commentedAt)).fromNow(), [e.commentedAt]),
        t = i.useMemo(() => {
            const c = e.content.split(`
`);
            let m = "";
            for (const u of c) {
                if (u === "") {
                    const p = document.createElement("br");
                    m += p.outerHTML;
                    continue
                }
                const l = document.createElement("p");
                l.textContent = u, m += l.outerHTML
            }
            return m
        }, [e.content]),
        a = (r = Ye((o = e.commenterEntityInfo) == null ? void 0 : o.entityInfo, "seriesInfo")) == null ? void 0 : r.isChampion;
    return s(jn, {
        isChampionCommenter: a,
        comment: e,
        commentDateFromNow: n,
        withBox: !1,
        commentHtmlContent: t
    })
}
const Qn = i.memo(Hn);
class _n extends g {
    constructor() {
        super("wuxiaworld.api.v2.CreateReviewCommentRequest", [{
            no: 1,
            name: "id",
            kind: "scalar",
            T: 5
        }, {
            no: 2,
            name: "content",
            kind: "scalar",
            T: 9,
            options: {
                "wuxiaworld.api.v2.stringLength": {
                    minLength: {
                        value: 1
                    },
                    maxLength: {
                        value: 2048
                    }
                },
                "wuxiaworld.api.v2.display": {
                    name: "Content"
                }
            }
        }, {
            no: 3,
            name: "novelId",
            kind: "scalar",
            oneof: "type",
            T: 5
        }, {
            no: 4,
            name: "productId",
            kind: "scalar",
            oneof: "type",
            T: 5
        }])
    }
}
const is = new _n;
class zn extends g {
    constructor() {
        super("wuxiaworld.api.v2.CreateReviewCommentsResponse", [{
            no: 1,
            name: "item",
            kind: "message",
            T: () => cs
        }])
    }
}
const Zn = new zn;
class Kn extends g {
    constructor() {
        super("wuxiaworld.api.v2.GetReviewCommentsRequest", [{
            no: 1,
            name: "id",
            kind: "scalar",
            T: 5
        }, {
            no: 2,
            name: "novelId",
            kind: "scalar",
            oneof: "type",
            T: 5
        }, {
            no: 3,
            name: "productId",
            kind: "scalar",
            oneof: "type",
            T: 5
        }, {
            no: 4,
            name: "pageInfo",
            kind: "message",
            T: () => Le
        }])
    }
}
const ls = new Kn;
class Xn extends g {
    constructor() {
        super("wuxiaworld.api.v2.GetReviewCommentsResponse", [{
            no: 1,
            name: "items",
            kind: "message",
            repeat: 1,
            T: () => cs
        }, {
            no: 2,
            name: "pageInfo",
            kind: "message",
            T: () => $e,
            options: {
                "wuxiaworld.api.v2.required": {
                    value: !0
                }
            }
        }])
    }
}
const Jn = new Xn;
class et extends g {
    constructor() {
        super("wuxiaworld.api.v2.ReviewCommenterSeriesInfo", [{
            no: 1,
            name: "isChampion",
            kind: "scalar",
            T: 8
        }])
    }
}
const st = new et;
class nt extends g {
    constructor() {
        super("wuxiaworld.api.v2.ReviewCommenterEntityInfo", [{
            no: 1,
            name: "seriesInfo",
            kind: "message",
            oneof: "entityInfo",
            T: () => st
        }])
    }
}
const tt = new nt;
class at extends g {
    constructor() {
        super("wuxiaworld.api.v2.ReviewCommentItem", [{
            no: 1,
            name: "id",
            kind: "scalar",
            T: 5
        }, {
            no: 2,
            name: "content",
            kind: "scalar",
            T: 9
        }, {
            no: 3,
            name: "commenter",
            kind: "message",
            T: () => Ge
        }, {
            no: 4,
            name: "commentedAt",
            kind: "message",
            T: () => z
        }, {
            no: 5,
            name: "isSticky",
            kind: "scalar",
            T: 8
        }, {
            no: 6,
            name: "commenterEntityInfo",
            kind: "message",
            T: () => tt
        }])
    }
}
const cs = new at,
    te = new Oe("wuxiaworld.api.v2.ReviewComments", [{
        name: "CreateReviewComment",
        options: {},
        I: is,
        O: Zn
    }, {
        name: "GetReviewComments",
        options: {},
        I: ls,
        O: Jn
    }]);
class ds {
    constructor(n) {
        this._transport = n, this.typeName = te.typeName, this.methods = te.methods, this.options = te.options
    }
    createReviewComment(n, t) {
        const a = this.methods[0],
            o = this._transport.mergeOptions(t);
        return L("unary", this._transport, a, o, n)
    }
    getReviewComments(n, t) {
        const a = this.methods[1],
            o = this._transport.mergeOptions(t);
        return L("unary", this._transport, a, o, n)
    }
}

function ot({
    review: e,
    onSubmitComment: n
}) {
    const {
        user: t
    } = H(), [a, o] = i.useState(""), {
        grpcRequest: r
    } = We(), [c, m] = i.useState(!1), [u, l] = i.useState(null), p = i.useCallback(async () => {
        var R;
        if (c) return;
        const h = a;
        $(() => {
            m(!0), l(null)
        });
        try {
            if (!h.trim().length) {
                l({
                    response: {
                        description: "Content length must be between 1 and 2048 characters.",
                        errors: [],
                        metadata: {}
                    },
                    status: je.INVALID_ARGUMENT,
                    name: "frontend error",
                    message: 'This is actually not an api error. It is "temporarily" implemented like an API error until the design guide is established.'
                });
                return
            }
            const N = is.create({
                id: e.id,
                type: e.type,
                content: h
            });
            (await r(ds, b => b.createReviewComment, N)).item && (o(""), n == null || n())
        } catch (N) {
            N instanceof ue ? (l(N), console.error((R = N.response) == null ? void 0 : R.description)) : console.error(N)
        } finally {
            m(!1)
        }
    }, [a, r, n, e.id, e.type, c]), v = i.useCallback(h => {
        o(h.target.value)
    }, []);
    return t ? d("div", {
        className: "relative pt-12 sm2:rounded-12 sm2:p-20 sm2:shadow-ww-text-container sm2:dark:bg-gray-950",
        children: [u && s(js, {
            alertProps: {
                className: "mb-[20px]"
            },
            error: u,
            onDismiss: () => l(null)
        }), s("div", {
            className: A("mb-4 inline-flex w-full rounded-8 bg-gray-container-base px-10 py-8", "hover:ring-1 hover:ring-inset hover:ring-blue-600"),
            children: s("textarea", {
                className: F("font-set-r16-h150 w-full resize-none bg-transparent pr-3 placeholder:text-gray-500 dark:text-white dark:placeholder:text-white/40"),
                name: "content",
                value: a,
                placeholder: "Add a Comment",
                onChange: v,
                disabled: c,
                readOnly: c,
                children: a
            })
        }), s("div", {
            children: s("div", {
                className: "pt-8 pb-20 text-right sm2:pt-12 sm2:pb-4",
                children: s(Fs, {
                    className: "font-set-sb13",
                    onClick: p,
                    disabled: c,
                    children: "Submit"
                })
            })
        }), s(Ws, {
            isFullScreen: !0,
            className: "sm2:hidden"
        })]
    }) : null
}

function rt({
    review: e,
    page: n,
    pageCount: t,
    enabled: a
}) {
    const o = pe(ls, {
        id: e.id,
        type: e.type,
        pageInfo: {
            page: n,
            count: t
        }
    });
    return ve(ds, c => c.getReviewComments, o, ["review-comments", e.id, n], {
        keepPreviousData: !0,
        enabled: a
    })
}
var it = 1 / 0,
    lt = ee && 1 / es(new ee([, -0]))[1] == it ? function(e) {
        return new ee(e)
    } : ys,
    ct = 200;

function dt(e, n, t) {
    var a = -1,
        o = _s,
        r = e.length,
        c = !0,
        m = [],
        u = m;
    if (t) c = !1, o = zs;
    else if (r >= ct) {
        var l = n ? null : lt(e);
        if (l) return es(l);
        c = !1, o = Qs, u = new Hs
    } else u = n ? [] : m;
    e: for (; ++a < r;) {
        var p = e[a],
            v = n ? n(p) : p;
        if (p = t || p !== 0 ? p : 0, c && v === v) {
            for (var h = u.length; h--;)
                if (u[h] === v) continue e;
            n && u.push(v), m.push(p)
        } else o(u, v, t) || (u !== m && u.push(v), m.push(p))
    }
    return m
}

function mt(e, n) {
    return e && e.length ? dt(e, Bs(n)) : []
}
const ut = 10;

function pt({
    review: e,
    OpenerComponent: n,
    onVote: t,
    entity: a
}) {
    var G, w;
    const {
        user: o
    } = H(), [r, c] = i.useState(!1), [m, u] = i.useState(!1), [l, p] = i.useState([]), [v, h] = i.useState(1), R = i.useRef(null), N = i.useCallback(() => {
        $(() => {
            h(1), c(!0)
        })
    }, []), x = i.useCallback(() => {
        c(!1)
    }, []), {
        data: b,
        refetch: C,
        ...T
    } = rt({
        pageCount: ut,
        review: e,
        page: v,
        enabled: r
    });
    i.useEffect(() => {
        b != null && b.items && $(() => {
            p(k => mt([...k, ...b.items], P => P.id)), u(!1)
        })
    }, [e.id, b]);
    const y = i.useCallback(() => {
            $(() => {
                u(!0), h(k => k + 1)
            })
        }, []),
        S = i.useCallback(async () => {
            const k = v;
            $(() => {
                h(1), p([])
            }), k === 1 && C()
        }, [v, C]);
    return d(i.Fragment, {
        children: [s("div", {
            onClick: N,
            children: n
        }), d(Fe, {
            open: r,
            onClose: x,
            maxWidth: "lg",
            fullWidth: !0,
            PaperProps: {
                className: A("sm:m-8", "!w-full !max-h-[calc(100%-16px)] overflow-x-hidden m-8 sm2:m-40 sm2:!max-w-[944px] sm2:!max-h-[calc(100%-80px)]")
            },
            children: [d(Be, {
                className: "p-0",
                children: [s("div", {
                    className: "font-set-b16 p-20 text-gray-t1 sm2:font-set-b21",
                    children: "Review Details"
                }), s("button", {
                    className: "absolute right-2 top-2 rounded-full p-10 text-gray-400 hover:bg-gray-200 hover:bg-black/[.04] dark:hover:bg-white/[.08]",
                    "aria-label": "close",
                    onClick: x,
                    children: s(Ze, {})
                })]
            }), d(He, {
                ref: R,
                className: "min-h-[50vh] overflow-x-hidden !px-20 !py-0 !pb-20",
                children: [s("div", {
                    className: "-mx-8 pb-8 pt-4 sm2:mx-0 sm2:pb-16",
                    children: s(us, {
                        review: e,
                        onVote: t,
                        entity: a,
                        disableReply: !0
                    }, e.id)
                }), o && s("div", {
                    className: "pt-8 sm2:pt-0 sm2:pb-16",
                    children: s(ot, {
                        review: e,
                        onSubmitComment: S
                    })
                }), s(Gs, {
                    status: T.isRefetching ? "loading" : T.status
                }), !!l.length && s("div", {
                    className: "pt-8 sm2:pt-0",
                    children: l.map(k => s(Qn, {
                        comment: k
                    }, k.id))
                }), T.status !== "loading" && ((G = b == null ? void 0 : b.pageInfo) == null ? void 0 : G.total) === 0 && s("div", {
                    className: "h-240 content-dead-center",
                    children: s("h4", {
                        className: "font-set-r15 text-gray-desc sm2:font-set-r16",
                        children: "No comments yet!"
                    })
                }), l.length !== 0 && l.length < ((w = b == null ? void 0 : b.pageInfo) == null ? void 0 : w.total) && s("div", {
                    className: "mt-20 content-dead-center",
                    children: s(Is, {
                        onClick: y,
                        children: "Load More"
                    })
                }), m && s("span", {
                    className: "mt-[15px] content-dead-center",
                    children: s(Qe, {
                        color: "secondary"
                    })
                })]
            })]
        })]
    })
}

function vt({
    isChampionReviewer: e,
    review: n,
    edited: t,
    reviewDateFromNow: a,
    reviewHtmlContent: o,
    upVoteCount: r,
    downVoteCount: c,
    onClickUpVote: m,
    onClickDownVote: u,
    entity: l,
    onVote: p,
    disableReply: v,
    withBox: h = !0
}) {
    const R = Ve(De.downSm2, {
        noSsr: !0
    });
    return s("article", {
        className: A("rounded-12 dark:bg-gray-950", h && "shadow-ww-text-container"),
        children: s("div", {
            className: "p-16 pb-12",
            children: R ? d(q, {
                children: [d("div", {
                    className: "flex pb-10",
                    children: [s(Me, {
                        isChampionReviewer: e,
                        review: n,
                        isMobile: R
                    }), s("div", {
                        className: "ml-8 min-w-0 sm2:ml-0",
                        children: s(Ue, {
                            review: n,
                            reviewDateFromNow: a,
                            edited: t
                        })
                    })]
                }), s(Pe, {
                    entity: l,
                    review: n,
                    reviewHtmlContent: o,
                    upVoteCount: r,
                    downVoteCount: c,
                    disableReply: v,
                    onVote: p,
                    onClickUpVote: m,
                    onClickDownVote: u
                })]
            }) : d("div", {
                className: "flex",
                children: [s(Me, {
                    isChampionReviewer: e,
                    review: n,
                    isMobile: R
                }), d("div", {
                    className: "min-w-0 sm2:ml-12",
                    children: [s("div", {
                        className: "ml-8 sm2:ml-0",
                        children: s(Ue, {
                            review: n,
                            reviewDateFromNow: a,
                            edited: t
                        })
                    }), s(Pe, {
                        entity: l,
                        review: n,
                        reviewHtmlContent: o,
                        upVoteCount: r,
                        downVoteCount: c,
                        disableReply: v,
                        onVote: p,
                        onClickUpVote: m,
                        onClickDownVote: u
                    })]
                })]
            })
        })
    })
}
const Me = ({
        isChampionReviewer: e,
        review: n,
        isMobile: t
    }) => {
        var a, o;
        return s(ht, {
            isChampion: e,
            frameWidth: t ? 2 : 3,
            src: (o = (a = n == null ? void 0 : n.reviewUser) == null ? void 0 : a.avatarUrl) == null ? void 0 : o.value,
            className: "h-40 w-40 sm2:h-60 sm2:w-60",
            variant: "rounded",
            frameClasses: {
                badge: "w-30 h-14 sm2:w-34 sm2:h-16"
            },
            imageRenderSize: e ? 54 : 60
        })
    },
    Ue = ({
        review: e,
        reviewDateFromNow: n,
        edited: t
    }) => {
        var a, o, r, c, m;
        return d(q, {
            children: [d("div", {
                className: "flex items-center pt-2",
                children: [s("div", {
                    className: "font-set-b14 truncate text-gray-t1 sm2:font-set-b16",
                    children: ((a = e.reviewUser) == null ? void 0 : a.userName) || "[Unknown Account]"
                }), ((r = (o = e.reviewUser) == null ? void 0 : o.flair) == null ? void 0 : r.value) && s(Xe, {
                    flair: e.reviewUser.flair.value
                }), ((c = e.reviewUser) == null ? void 0 : c.isVipActive) && s("div", {
                    className: "ml-2 sm2:ml-4",
                    children: s(we, {
                        badgeType: "vip",
                        vipType: (m = e.reviewUser.vip) == null ? void 0 : m.type
                    })
                })]
            }), d("div", {
                className: "font-set-r12 flex pt-2 text-gray-desc sm2:font-set-r13",
                children: [s("span", {
                    children: n
                }), t && d(q, {
                    children: [s(wt, {}), s("span", {
                        children: "Edited"
                    })]
                })]
            })]
        })
    },
    Pe = ({
        entity: e,
        review: n,
        reviewHtmlContent: t,
        upVoteCount: a,
        downVoteCount: o,
        disableReply: r,
        onVote: c,
        onClickUpVote: m,
        onClickDownVote: u
    }) => {
        const l = Je(t || "", {
            transform: {
                p: Ys
            }
        });
        return d("div", {
            className: "sm2:pt-12",
            children: [d("div", {
                className: "flex items-center pb-2 sm2:pb-0",
                children: [s(ft, {
                    recommended: n.voteType === U.ThumbsUp
                }), n.hasPurchased && s("div", {
                    className: "ml-6",
                    children: s(we, {
                        badgeType: "purchased"
                    })
                })]
            }), d(Y, {
                children: [s(Y.Content, {
                    className: "font-set-r15-h150 text-gray-t1 sm2:font-set-r16-h150",
                    lines: 3,
                    children: l
                }), s(Y.Toggle, {
                    className: "font-set-m12 mt-6",
                    showingComponent: s(Z, {
                        showing: !0
                    }),
                    hidingComponent: s(Z, {
                        showing: !1
                    })
                })]
            }), d("div", {
                className: "flex pt-12",
                children: [s("div", {
                    className: "py-6 pr-12",
                    children: s(ae, {
                        count: a,
                        onClick: m,
                        IconComponent: ke
                    })
                }), s("div", {
                    className: "py-6 pr-12",
                    children: s(ae, {
                        classes: {
                            icon: "rotate-180"
                        },
                        count: o,
                        onClick: u,
                        IconComponent: ke
                    })
                }), s("div", {
                    children: s(pt, {
                        review: n,
                        OpenerComponent: s("div", {
                            className: "py-6 pr-12",
                            children: s(ae, {
                                count: n.totalComments,
                                IconComponent: qs,
                                disabled: r
                            })
                        }),
                        onVote: c,
                        entity: e
                    })
                })]
            })]
        })
    },
    ht = ({
        isChampion: e,
        frameWidth: n,
        frameClasses: t,
        className: a,
        ...o
    }) => e ? s(ze, {
        frameWidth: n,
        classes: t,
        children: s(K, { ...o,
            className: "h-36 w-36 border-none sm2:h-54 sm2:w-54"
        })
    }) : d("div", {
        className: "relative",
        children: [s(K, { ...o,
            className: F(a, "rounded-6 border-none sm2:rounded-8")
        }), s("div", {
            className: F(Ke, a, "rounded-6 ring-[0.5px] ring-inset ring-black/10 sm2:rounded-8")
        })]
    }),
    wt = () => s("div", {
        className: "w-10 text-center",
        children: "·"
    }),
    ft = ({
        recommended: e
    }) => {
        const n = e ? "Recommended" : "Not recommended";
        return d("div", {
            className: A("flex items-center", e ? "text-green-600" : "text-red-700"),
            children: [s(Wn, {
                className: A("h-18 w-18", !e && "rotate-180")
            }), s("span", {
                className: "font-set-b15 pl-4 font-extrabold italic sm2:font-set-b16 sm2:font-extrabold sm2:italic",
                children: n
            })]
        })
    },
    ae = ({
        IconComponent: e,
        classes: n,
        count: t,
        disabled: a,
        ...o
    }) => d("button", {
        className: A("flex text-gray-t3", a ? "cursor-auto" : "hover:text-blue-600 dark:hover:text-blue-600"),
        onClick: r => {
            a && r.stopPropagation()
        },
        ...o,
        children: [s(e, {
            className: A("h-16 w-16", n == null ? void 0 : n.icon)
        }), s("span", {
            className: "font-set-m14 pl-4",
            children: t
        })]
    });
var ms = {
    exports: {}
};
(function(e, n) {
    (function(t, a) {
        e.exports = a()
    })(As, function() {
        var t = {
            LTS: "h:mm:ss A",
            LT: "h:mm A",
            L: "MM/DD/YYYY",
            LL: "MMMM D, YYYY",
            LLL: "MMMM D, YYYY h:mm A",
            LLLL: "dddd, MMMM D, YYYY h:mm A"
        };
        return function(a, o, r) {
            var c = o.prototype,
                m = c.format;
            r.en.formats = t, c.format = function(u) {
                u === void 0 && (u = "YYYY-MM-DDTHH:mm:ssZ");
                var l = this.$locale().formats,
                    p = function(v, h) {
                        return v.replace(/(\[[^\]]+])|(LTS?|l{1,4}|L{1,4})/g, function(R, N, x) {
                            var b = x && x.toUpperCase();
                            return N || h[x] || t[x] || h[b].replace(/(\[[^\]]+])|(MMMM|MM|DD|dddd)/g, function(C, T, y) {
                                return T || y.slice(1)
                            })
                        })
                    }(u, l === void 0 ? {} : l);
                return m.call(this, p)
            }
        }
    })
})(ms);
var gt = ms.exports;
const xt = Ss(gt);
B.extend(xt);

function us({
    review: e,
    onVote: n,
    entity: t,
    disableReply: a,
    withBox: o
}) {
    var G, w, k, P, _;
    const [r, c] = Ks(e), m = (G = r.votes) == null ? void 0 : G.upVotes, u = (w = r.votes) == null ? void 0 : w.downVotes, {
        user: l,
        login: p
    } = H(), {
        grpcRequest: v
    } = We();
    i.useEffect(() => {
        c(e)
    }, [e, c]);
    const h = i.useMemo(() => W.is(t) ? j.NovelReviewType : he.is(t) ? j.ProductReviewType : j.NoneReviewType, [t]),
        R = i.useCallback(async I => {
            var O;
            const E = ts.create({
                id: r.id,
                type: h,
                voteType: I === "upvote" ? U.ThumbsUp : U.ThumbsDown
            });
            try {
                (await v(fe, J => J.submitReviewVote, E)).result && (n == null || n())
            } catch (M) {
                console.error(M), M instanceof ue && console.error((O = M.response) == null ? void 0 : O.description)
            }
        }, [h, v, n, r.id]),
        N = i.useCallback(async () => {
            var I;
            if (!l) {
                p();
                return
            }
            l.id !== ((I = r.reviewUser) == null ? void 0 : I.id) && (ie(le.ClickSeriesReviewLikeDislike)({
                entity: t,
                review: r,
                voteState: "up"
            }), await R("upvote"))
        }, [t, p, r, l, R]),
        x = i.useCallback(async () => {
            var I;
            if (!l) {
                p();
                return
            }
            l.id !== ((I = r.reviewUser) == null ? void 0 : I.id) && (ie(le.ClickSeriesReviewLikeDislike)({
                entity: t,
                review: r,
                voteState: "down"
            }), await R("downvote"))
        }, [t, p, r, l, R]),
        b = i.useMemo(() => {
            var O;
            const I = (((O = r.content) == null ? void 0 : O.value) || "").split(`
`),
                E = [];
            for (const M of I) M.length !== 0 && E.push(new Xs("p", {}, [new Js(M)]));
            return Zs(E)
        }, [(k = r.content) == null ? void 0 : k.value]),
        C = i.useMemo(() => B.unix(re(r.reviewedAt)), [r.reviewedAt]),
        T = i.useMemo(() => r.editedAt ? B.unix(re(r.editedAt)) : null, [r.editedAt]),
        S = {
            isChampionReviewer: (_ = Ye((P = r == null ? void 0 : r.reviewerEntityInfo) == null ? void 0 : P.entityInfo, "seriesInfo")) == null ? void 0 : _.isChampion,
            review: r,
            edited: !!T,
            reviewDateFromNow: C.fromNow(),
            reviewHtmlContent: b,
            upVoteCount: m || 0,
            downVoteCount: u || 0,
            onClickUpVote: N,
            onClickDownVote: x,
            onVote: n,
            entity: t,
            disableReply: a,
            withBox: o
        };
    return s(vt, { ...S
    })
}
const bt = i.lazy(() => Ms(() =>
    import ("./review.submit.form.DEbzpy2I.min.js"), __vite__mapDeps([0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27])), {
    ssr: !1
});

function Rt({
    entity: e,
    onReviewSubmission: n,
    onCancelReview: t,
    onUserReviewFetched: a
}) {
    const {
        showError: o
    } = Us(), {
        user: r
    } = H(), c = _e(), [m, u] = i.useState(!1), l = i.useMemo(() => W.is(e) ? "novel" : he.is(e) ? "product" : "unknown", [e]), p = pe(as, {
        type: e ? l === "novel" ? {
            oneofKind: "novelId",
            novelId: e.id
        } : l === "product" ? {
            oneofKind: "productId",
            productId: e.id
        } : void 0 : void 0,
        userId: r == null ? void 0 : r.id
    }), {
        data: v,
        error: h
    } = ve(fe, x => x.getUserReview, p, ["user-review", l, e == null ? void 0 : e.id, r == null ? void 0 : r.id], {
        enabled: !!r && !!e && !m,
        staleTime: Number.POSITIVE_INFINITY,
        refetchOnMount: !0,
        suspense: !0,
        useErrorBoundary: !1,
        onSuccess: x => {
            a == null || a(!!x.item)
        }
    });
    i.useEffect(() => {
        h instanceof ue && h.status === je.NOT_FOUND ? (u(!0), a == null || a(!1)) : h && (async () => {
            try {
                await o(!0, h)
            } catch {}
        })()
    }, [h, a, o]);
    const R = i.useCallback((x, b) => {
            if (n == null || n(x, b), b) c.setQueryData(["user-review", l, e == null ? void 0 : e.id, r == null ? void 0 : r.id], C => Te(C, T => {
                T.item = x
            })), c.setQueriesData(["reviews", l, e == null ? void 0 : e.id], C => Te(C, T => {
                const y = C.items.findIndex(S => S.id === x.id);
                y > -1 && (T.items[y] = x)
            }));
            else {
                const C = os.create({
                    item: x
                });
                c.setQueryData(["user-review", l, e == null ? void 0 : e.id, r == null ? void 0 : r.id], C)
            }
        }, [e == null ? void 0 : e.id, n, c, l, r == null ? void 0 : r.id]),
        {
            item: N
        } = v || {
            item: null
        };
    return !m && status === "loading" ? s("div", {
        className: "content-dead-center",
        children: s(Qe, {
            disableShrink: !0,
            color: "secondary"
        })
    }) : !v && !m ? null : s(bt, {
        review: N || null,
        entity: e,
        onCancelReview: t,
        onReviewSubmission: R
    })
}
const V = i.memo(function({
        className: n,
        ...t
    }) {
        return s(Ps, {
            className: A("bg-[#ffffff] dark:bg-[#2a2a2a]", n),
            ...t
        })
    }),
    Nt = i.memo(function() {
        return s("div", {
            className: "mb-[16px] rounded-[10px] bg-[#f5f5f5] px-[16px] pt-[16px] pb-[36px] dark:bg-[#333] sm:pt-[32px] sm:pr-[20px] sm:pl-[30px] sm:pb-[39px]",
            children: d("div", {
                className: "flex flex-col space-y-[30px] sm:flex-row sm:space-x-[30px] sm:space-y-0",
                children: [d("div", {
                    children: [s(V, {
                        className: "mx-auto mb-[10px] h-[56px] w-[56px] rounded-[4px] sm:h-[65px] sm:w-[65px]",
                        variant: "rectangular",
                        animation: "pulse"
                    }), s(V, {
                        className: "mx-auto",
                        height: 20,
                        width: 109,
                        variant: "rectangular",
                        animation: "wave"
                    })]
                }), d("div", {
                    className: "flex-1",
                    children: [d("div", {
                        className: "mb-[50px] flex flex-col space-y-[12px]",
                        children: [s(V, {
                            height: 20,
                            width: "100%",
                            variant: "rectangular",
                            animation: "wave"
                        }), s(V, {
                            height: 20,
                            width: "60%",
                            variant: "rectangular",
                            animation: "wave"
                        }), s(V, {
                            height: 20,
                            width: "100%",
                            variant: "rectangular",
                            animation: "wave"
                        }), s(V, {
                            height: 20,
                            width: "60%",
                            variant: "rectangular",
                            animation: "wave"
                        })]
                    }), s(V, {
                        height: 20,
                        width: 109,
                        variant: "rectangular",
                        animation: "wave"
                    })]
                })]
            })
        })
    });
var de = (e => (e[e.None = 0] = "None", e[e.Relevance = 1] = "Relevance", e[e.Newest = 2] = "Newest", e[e.Oldest = 3] = "Oldest", e[e.Best = 4] = "Best", e[e.Worst = 5] = "Worst", e))(de || {}),
    Ee;

function me() {
    return me = Object.assign ? Object.assign.bind() : function(e) {
        for (var n = 1; n < arguments.length; n++) {
            var t = arguments[n];
            for (var a in t) Object.prototype.hasOwnProperty.call(t, a) && (e[a] = t[a])
        }
        return e
    }, me.apply(this, arguments)
}
var Ct = function(n) {
    return i.createElement("svg", me({
        width: 12,
        height: 12,
        viewBox: "0 0 12 12",
        fill: "none",
        xmlns: "http://www.w3.org/2000/svg"
    }, n), Ee || (Ee = i.createElement("path", {
        d: "M5.737 3 1 8h9.474L5.737 3Z",
        fill: "currentColor"
    })))
};

function Tt({
    onChange: e,
    defaultValue: n,
    options: t
}) {
    const [a, o] = i.useState(!1), [r, c] = i.useState(() => t.find(l => l.value === n && n !== void 0) || t[0]), m = i.useRef(null);
    i.useEffect(() => {
        const l = t.find(p => p.value === n);
        l && c(l)
    }, [n, t]), dn(m, () => {
        o(!1)
    });
    const u = l => {
        o(!1), c(l), e(l)
    };
    return d("div", {
        ref: m,
        className: "relative inline-block rounded-[6px] bg-gray-container-base ring-transparent transition-shadow hover:shadow-md hover:ring-1 hover:ring-inset hover:ring-blue-600",
        children: [s("button", {
            onClick: () => o(l => !l),
            children: d("div", {
                className: "font-set-sb14 flex items-center px-[12px] py-[8px] text-gray-t1",
                children: [r.text, s(Ct, {
                    className: A("ml-[6px] text-gray-800 dark:text-gray-500", !a && "rotate-180")
                })]
            })
        }), a && s("div", {
            className: "absolute top-[calc(100%+8px)] right-0 z-10 w-[160px] rounded-[8px] bg-white py-[4px] shadow-ww-text-container dark:bg-gray-850",
            children: s("div", {
                children: t.map(l => d("div", {
                    onClick: () => u(l),
                    className: "font-set-sb14 py-[10px] px-[12px] text-gray-t1 hover:bg-gray-100 dark:hover:bg-white/10",
                    children: [l.text, l.value === r.value && null]
                }, l.value))
            })
        })]
    })
}
ps.defaultProps = {
    title: !0,
    submitReview: !0,
    pagination: !0,
    sorting: !0,
    reviewCount: 10
};

function kt({
    children: e
}) {
    return s("div", {
        children: e
    })
}

function yt() {
    return s("span", {
        className: "font-set-sb14 cursor-pointer text-blue-600 sm2:font-set-sb15 hover:underline",
        children: "View All"
    })
}

function ps({
    entity: e,
    submitReview: n,
    pagination: t,
    sorting: a,
    reviewCount: o,
    wrapperComponent: r,
    onReviewsLoaded: c,
    onCancelReview: m,
    showsDialogOpener: u
}) {
    var xe, be, Re, Ne, Ce;
    const {
        user: l
    } = H(), [p, v] = i.useState(null), [h, R] = i.useState(!1), [N, x] = i.useState(X.Relevance), [b, C] = i.useState(null), T = i.useRef(null), y = i.useRef(null), S = i.useMemo(() => W.is(e) ? "novel" : he.is(e) ? "product" : "unknown", [e]), G = pe(rs, {
        type: e ? S === "novel" ? {
            oneofKind: "novelId",
            novelId: e.id
        } : S === "product" ? {
            oneofKind: "productId",
            productId: e.id
        } : void 0 : void 0,
        sortType: N,
        pageInfo: {
            page: p ? ? 1,
            count: o
        }
    }), {
        data: w,
        ...k
    } = ve(fe, f => f.searchReviews, G, ["reviews", S, e == null ? void 0 : e.id, p ? ? 1, N, o], {
        suspense: !0,
        enabled: !!e,
        staleTime: Number.POSITIVE_INFINITY,
        keepPreviousData: !0,
        showModalOnError: t ? !0 : void 0,
        onSuccess(f) {
            c == null || c((f == null ? void 0 : f.items.length) > 0)
        }
    }), P = i.useCallback(async () => {
        y.current && y.current.scrollIntoView({
            behavior: "smooth"
        })
    }, []), _ = i.useMemo(() => {
        var f;
        return w != null && w.items ? Math.ceil((((f = w == null ? void 0 : w.pageInfo) == null ? void 0 : f.total) || 0) / o) : 0
    }, [w == null ? void 0 : w.items, (xe = w == null ? void 0 : w.pageInfo) == null ? void 0 : xe.total, o]), I = i.useCallback(async (f, D) => {
        $(() => {
            v(D), R(!0)
        }), await P()
    }, [P]);
    i.useEffect(() => {
        R(f => f && !1)
    }, [w]);
    const E = _e(),
        O = async () => {
            E.removeQueries(["reviews", S, e == null ? void 0 : e.id, o]), $(() => {
                v(1), C(!0), x(X.Newest)
            }), P()
        },
        M = async (f, D) => {
            !l || !w || (e && W.is(e) && ie(le.ClickSubmitSeriesReview)({
                entity: e,
                review: f,
                on: D ? "Edit" : "New"
            }), D || O())
        },
        J = f => {
            if (b === null) {
                C(f);
                return
            }
            b || !b && f && O()
        },
        hs = i.useCallback(() => {
            l && E.invalidateQueries(["reviews"])
        }, [E, l]),
        ws = i.useCallback(f => {
            $(() => {
                v(1), R(!0), x(f.value)
            })
        }, []),
        ge = h && k.isFetching || !w;
    return d(q, {
        children: [s("div", {
            ref: T
        }), !!w && d(r || kt, {
            entity: e,
            loaded: !0,
            children: [n && !!l && s(i.Suspense, {
                fallback: s(Es, {
                    className: "h-[260px]",
                    displayType: "indicator"
                }),
                children: s("div", {
                    className: "pb-20 sm2:pb-32",
                    children: s(Rt, {
                        entity: e,
                        onReviewSubmission: M,
                        onCancelReview: m,
                        onUserReviewFetched: J
                    })
                })
            }), s("div", {
                ref: y,
                children: d("div", {
                    className: "flex items-center",
                    children: [W.is(e) && d("div", {
                        className: "sm2:flex",
                        children: [s(se, {
                            isLoading: !e,
                            reviewRating: (Re = (be = e == null ? void 0 : e.reviewInfo) == null ? void 0 : be.rating) == null ? void 0 : Re.value,
                            classes: {
                                goodIcon: "sm2:w-24 sm2:h-24 mr-4",
                                rating: "font-set-b24 sm2:font-set-b28 text-gray-t1"
                            },
                            children: s(se.MedalIcon, {
                                className: "sm2:h-24 sm2:w-24"
                            })
                        }), s(se.Count, {
                            count: (Ne = e == null ? void 0 : e.reviewInfo) == null ? void 0 : Ne.count,
                            className: "font-set-sb15 ml-0 self-end text-gray-t3 sm2:ml-2"
                        })]
                    }), u && s("div", {
                        className: "ml-auto",
                        children: s(vs, {
                            entity: e,
                            DialogOpenerComponent: s(yt, {})
                        })
                    }), a && s("div", {
                        className: "ml-auto",
                        children: s(Tt, {
                            options: It,
                            onChange: ws,
                            defaultValue: N
                        })
                    })]
                })
            }), ge && s("div", {
                className: "pt-[15px]",
                children: Array(o).fill(null).map((f, D) => s(Nt, {}, D))
            }), !ge && d("div", {
                className: "-mx-8 flex flex-col space-y-12 pt-16 sm2:mx-0 sm2:pt-20",
                children: [(Ce = w == null ? void 0 : w.items) == null ? void 0 : Ce.map(f => s(us, {
                    review: f,
                    onVote: hs,
                    entity: e
                }, f.id)), w.items.length === 0 && s("div", {
                    className: "px-8 sm2:px-0",
                    children: "No reviews found"
                })]
            }), t && s(ln, {
                className: "panel panel-footer px-0 py-[20px]",
                children: s(Os, {
                    classes: {
                        ul: "space-x-4 sm2:space-x-6"
                    },
                    count: _,
                    page: p ? ? 1,
                    onChange: I,
                    renderItem: f => s(Ls, {
                        className: "font-set-r16 mx-0 sm2:h-32 sm2:w-32",
                        ...f
                    })
                })
            })]
        })]
    })
}
const It = Object.keys(de).filter(Number).map(e => ({
        text: de[e],
        value: Number(e)
    })),
    vs = i.forwardRef(function({
        entity: n,
        DialogOpenerComponent: t,
        onOpenerClick: a,
        onClose: o
    }, r) {
        const [c, m] = i.useState(!1), u = i.useRef(null), l = i.useCallback(() => {
            m(!0)
        }, []), p = i.useCallback(() => {
            m(!1), o == null || o()
        }, [o]), [, v] = i.useState(!0), h = i.useCallback(() => {
            v(!1)
        }, []);
        i.useImperativeHandle(r, () => ({
            open: () => m(!0)
        }), []);
        const R = i.useCallback(() => {
            a == null || a(), l()
        }, [a, l]);
        return d(q, {
            children: [t && s("div", {
                className: "inline-block",
                onClick: R,
                children: t
            }), d(Fe, {
                open: c,
                onClose: p,
                maxWidth: "lg",
                fullWidth: !0,
                PaperProps: {
                    className: A("sm:m-8", "!w-full !max-h-[calc(100%-16px)] m-8 sm2:m-40 sm2:!max-w-[944px] sm2:!max-h-[calc(100%-80px)]")
                },
                children: [d(Be, {
                    className: "m-20 p-0",
                    children: [s("span", {
                        className: "font-set-b16 text-gray-t1 sm2:font-set-b21",
                        children: "All Reviews"
                    }), s("button", {
                        className: "absolute right-2 top-2 rounded-full p-10 text-gray-400 hover:bg-gray-200 hover:bg-black/[.04] dark:hover:bg-white/[.08]",
                        "aria-label": "close",
                        onClick: p,
                        children: s(Ze, {})
                    })]
                }), s(He, {
                    ref: u,
                    className: "min-h-[50vh] overflow-x-hidden !px-[20px] !pb-0",
                    children: c && !!n && s($s, {
                        displayType: "indicator",
                        children: s(ps, {
                            entity: n,
                            onReviewsLoaded: h
                        })
                    })
                })]
            })]
        })
    });
vs.defaultProps = {
    submitReview: !0
};
export {
    un as C, Nt as R, Tt as S, wn as U, ps as a, vs as b, ns as c, U as d, Wn as e, fe as f
};
//# sourceMappingURL=reviews.dialog.BrIYXWli.min.js.map